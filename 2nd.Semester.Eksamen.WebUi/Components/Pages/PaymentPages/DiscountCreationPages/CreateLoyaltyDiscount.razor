@namespace _2nd.Semester.Eksamen.WebUi.Components.Pages.PaymentPages.DiscountCreationPages
@using _2nd.Semester.Eksamen.Domain.Entities.Discounts
@using _2nd.Semester.Eksamen.Application.ApplicationInterfaces
@using _2nd.Semester.Eksamen.Application.DTO.ProductDTO
@using _2nd.Semester.Eksamen.WebUi.Components.Shared
@rendermode InteractiveServer

<div class="container">
    <EditForm Model="@discount" class="row p-3">
        <div>
            <h2>@(IsEdit ? "Rediger Loyalitets Rabat" : "Opret Loyalitets Rabat")</h2>
            <div class="d-flex flex-column p-1">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <div class="row mb-3">
                    <div class="col-md-12">
                        <label for="Name" class="form-labels">Navn:</label>
                        <InputText id="Name" @bind-Value="discount.Name" class="form-control" placeholder="Rabat navn..." />
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-12">
                        <label for="MinimumVisits" class="form-labels">Minimum besøg:</label>
                        <InputNumber id="MinimumVisits" @bind-Value="discount.MinimumVisits" class="form-control" />
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-12">
                        <label for="DiscountType" class="form-labels">Type af loyalitetsrabat:</label>
                        <InputText id="DiscountType" @bind-Value="discount.DiscountType" class="form-control" placeholder="Type..." />
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-12">
                        <label for="TreatmentDiscount" class="form-labels">Rabat på behandling (%):</label>
                        <InputNumber id="TreatmentDiscount" @bind-Value="discount.TreatmentDiscount" class="form-control" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label for="ProductDiscount" class="form-labels">Rabat på produkt (%):</label>
                        <InputNumber id="ProductDiscount" @bind-Value="discount.ProductDiscount" class="form-control" />
                    </div>
                </div>
                <div class="d-flex flex-column">
                    <div>
                        <label for="AppliesToTreatment" class="form-labels">Gælder for behandlinger</label>
                        <InputCheckbox id="AppliesToTreatment" @bind-Value="discount.AppliesToTreatment" class="form-check-input" />
                    </div>
                    <div>
                        <label for="AppliesToProduct" class="form-labels">Gælder for produkter</label>
                        <InputCheckbox id="AppliesToProduct" @bind-Value="discount.AppliesToProduct" class="form-check-input" />
                    </div>
                </div>
            </div>
            @if (IsEdit)
            {
                <button class="btn card-btn w-100" @onclick="UpdateDiscount">Gem Ændringer</button>
            }
        </div>
    </EditForm>
</div>

@code {
    [Parameter] public LoyaltyDiscountDTO discount { get; set; }
    [Parameter] public EventCallback<LoyaltyDiscountDTO> discountChanged { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    [Inject] IDiscountApplicationService _discountService { get; set; }
    [Parameter] public bool IsEdit { get; set; } = false;
    [Parameter] public DiscountOverviewDTO discountEdit { get; set; }
    protected override async Task OnInitializedAsync()
    {
        if (IsEdit)
        {
            discount = new LoyaltyDiscountDTO(discountEdit);
        }
    }
    public async Task OnChange()
    {
        await discountChanged.InvokeAsync(discount);
    }
    public async Task UpdateDiscount()
    {
        try
        {
            await _discountService.UpdateLoyaltyDiscountAsync(discount);
            await OnClose.InvokeAsync();
        }
        catch
        {

        }
    }
}


