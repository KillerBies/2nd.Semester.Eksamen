@page "/BookingForm"
@rendermode InteractiveServer
@using System.ComponentModel.DataAnnotations
@using _2nd.Semester.Eksamen.WebUi.Components.Pages
@using _2nd.Semester.Eksamen.WebUi.Components.Shared
@using _2nd.Semester.Eksamen.Domain.RepositoryInterfaces;
@inject NavigationManager Navi
@inject ICustomerRepository customerRepository

@if (!string.IsNullOrEmpty(_errorMessage))
{
    <div class="alert alert-danger">
        @_errorMessage
    </div>
}
<div class="page-header">
    <span class="title">Kunde Navn</span>
</div>
<EditForm EditContext="@EditContext" class="row p-5" style="margin-left: 20%; margin-right: 20%;"
          OnValidSubmit="@HandleValidSubmit"
          OnInvalidSubmit="@HandleInvalidSubmit">

    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="Treatments">
        @for(int i=0; i<Booking.TreatmentBookingDTOs.Count(); i++)
        {
            <TreatmentEditor TreatmentBooking="Booking.TreatmentBookingDTOs[i]"
                             OnRemove="RemoveTreatment"
                             PossibleEmployees="AllEmployees"
                             PossibleTreatments="AllTreatments"
                             Onchange="UpdateTreatment"
                             Index="i"
                             OnDown="MoveDown"
                             OnUp="MoveUp">
            </TreatmentEditor>
        }
    </div>
    <button class="add-treatment" type="button" title="Tilføj Behandling" @onclick="AddTreatment">+</button>
    <div class="possible-times-container">
        <div class="possible-times-header" style="border-radius:@(Open ? "12px 12px 0 0":"12px 12px 12px 12px");">
            <div>
                <span class="title">Start Tid</span>
                <input type="datetime-local" @bind-value="Booking.Start" @onselect="Arrange" />
            </div>
            <div class="btn-group">
                <button type="button" class="refesh" @onclick="ToggleDropdown" title="Opdater Mulige Tider">Generer Mulige Tider</button>
            </div>
        </div>
        @if (Open)
        {
            <div class="time-grid">
                    @foreach (var availableTime in AvailableBookingSpots)
                    {
                        <TimeCard OnSelect="SelectTimeSlot" availableTime="availableTime"></TimeCard>
                    }
            </div>
        }
    </div>

    <div class="btn-group">
        <button type="button" class="btn btn-primary mt-3" title="Anuller Booking" @onclick="OnCancel">Anuller</button>
        <button type="submit" class="btn btn-primary mt-3" title="Lav Booking" @onclick="CreateBooking" disabled="@(!(EditContext.Validate() && AllEmployees.Any()&&AllTreatments.Any()))">Lav Booking</button>
    </div>
</EditForm>
<p>@Booking.Start</p>
<p>@Booking.End</p>
@foreach(var treatment in Booking.TreatmentBookingDTOs)
{
    <div>
    @treatment.Treatment.Name
    </div>
}
